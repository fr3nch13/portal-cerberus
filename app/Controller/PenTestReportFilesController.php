<?php
App::uses('AppController', 'Controller');

class PenTestReportFilesController extends AppController 
{
	public function index() 
	{
		$this->Prg->commonProcess();
		
		$conditions = array(
		); 
		
		$this->PenTestReportFile->recursive = 0;
		$this->paginate['conditions'] = $this->PenTestReportFile->conditions($conditions, $this->passedArgs); 
		
		$this->paginate['order'] = array('PenTestReportFile.created' => 'desc');
		$this->set('pen_test_report_files', $this->paginate());
	}
	
	public function pen_test_report($pen_test_report_id = null) 
	{
		$this->Prg->commonProcess();
		
		if (!$pen_test_report = $this->PenTestReportFile->PenTestReport->read(null, $pen_test_report_id)) 
		{
			throw new NotFoundException(__('Invalid %s', __('Pen Test Report')));
		}
		$this->set('pen_test_report', $pen_test_report);
		
		$conditions = array(
			'PenTestReportFile.pen_test_report_id' => $pen_test_report_id,
		); 
		
		$this->paginate['conditions'] = $this->PenTestReportFile->conditions($conditions, $this->passedArgs); 
		if(isset($this->request->params['ext']) and $this->request->params['ext'] === 'csv')
		{
			$this->paginate['limit'] = $this->PenTestReportFile->find('count', array('conditions' => $this->paginate['conditions']));
			$this->layout = 'Utilities.../ajax_nodebug';
		}
		
		$this->paginate['order'] = array('PenTestReportFile.created' => 'desc');
		$this->set('pen_test_report_files', $this->paginate());
	}
	
	public function add($pen_test_report_id = null) 
	{
		
		if (!$pen_test_report = $this->PenTestReportFile->PenTestReport->read(null, $pen_test_report_id)) 
		{
			throw new NotFoundException(__('Invalid %s', __('Pen Test Report')));
		}
		$this->set('pen_test_report', $pen_test_report);
		
		$this->request->data[$this->PenTestReportFile->alias]['pen_test_report_id'] = $pen_test_report_id;
		$this->request->data[$this->PenTestReportFile->alias]['user_id'] = AuthComponent::user('id');
		
		if ($this->request->is('post')) 
		{
			$this->PenTestReportFile->create();
			if ($this->PenTestReportFile->save($this->request->data))
			{
				$this->Session->setFlash(__('The %s has been saved.', __('%s %s', __('Pen Test Report'), __('File'))));
				return $this->redirect(array('controller' => 'pen_test_reports', 'action' => 'view', $pen_test_report_id, '#' => 'ui-tabs-2'));
			}
			else
			{
				$this->Session->setFlash(__('The %s file could not be saved. Reason: %s', __('%s %s', __('Pen Test Report'), __('File')), $this->PenTestReportFile->modelError));
			}
		}
	}
	
	public function edit($id = null) 
	{
		$this->PenTestReportFile->recursive = -1;
		if (!$pen_test_report_file = $this->PenTestReportFile->read(null, $id))
		{
			throw new NotFoundException(__('Invalid %s', __('%s %s', __('Pen Test Report'), __('File'))));
		}
		
		if ($this->request->is(array('post', 'put'))) 
		{
			if ($this->PenTestReportFile->save($this->request->data))
			{
				$this->Session->setFlash(__('The %s has been saved.', __('%s %s', __('Pen Test Report'), __('File'))));
				return $this->redirect(array('controller' => 'pen_test_reports', 'action' => 'view', $pen_test_report_file['PenTestReportFile']['pen_test_report_id'], '#' => 'ui-tabs-2'));
			}
			else
			{
				$this->Session->setFlash(__('The %s could not be saved. Please, try again.', __('%s %s', __('Pen Test Report'), __('File'))));
			}
		}
		else
		{
			$this->request->data = $pen_test_report_file;
		}
	}
	
	public function delete($id = null)
	{
		$this->PenTestReportFile->recursive = -1;
		if (!$pen_test_report_file = $this->PenTestReportFile->read(null, $id))
		{
			throw new NotFoundException(__('Invalid %s', __('%s %s', __('Pen Test Report'), __('File'))));
		}
		
		if ($this->PenTestReportFile->delete())
		{
			$this->Session->setFlash(__('The %s has been deleted.', __('%s %s', __('Pen Test Report'), __('File'))));
		}
		else
		{
			$this->Session->setFlash(__('The %s could not be deleted. Please, try again.', __('%s %s', __('Pen Test Report'), __('File'))));
		}
		
		return $this->redirect(array('controller' => 'pen_test_reports', 'action' => 'view', $pen_test_report_file['PenTestReportFile']['pen_test_report_id'], '#' => 'ui-tabs-2'));
	}
	
	public function admin_pen_test_report($pen_test_report_id = null) 
	{
		return $this->pen_test_report($pen_test_report_id);
	}
}
