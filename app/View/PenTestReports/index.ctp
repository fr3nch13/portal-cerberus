<?php 
// File: app/View/PenTestReports/index.ctp
$page_options = array();

if($this->Wrap->roleCheck(array('admin')))
{
	$page_options[] = $this->Html->link(__('Add %s', __('Pen Test Report')), array('action' => 'add', 'admin' => true));
}

// content
$th = array(
	'PenTestReport.name' => array('content' => __('Name'), 'options' => array('sort' => 'PenTestReport.name', 'editable' => array('type' => 'text'))),
	'PenTestReport.result_count' => array('content' => __('# %s', __('Pen Test Results'))),
	'PenTestReport.report_date' => array('content' => __('Report Date'), 'options' => array('sort' => 'PenTestReport.report_date', 'editable' => array('type' => 'date'))),
	'PenTestReport.reports_event_id' => array('content' => __('Reports Event'), 'options' => array('sort' => 'ReportsEvent.name', 'editable' => array('type' => 'select', 'options' => $reportsEvents))),
	'PenTestReport.created' => array('content' => __('Created'), 'options' => array('sort' => 'PenTestReport.created')),
	'PenTestReport.modified' => array('content' => __('Modified'), 'options' => array('sort' => 'PenTestReport.modified')),
	'actions' => array('content' => __('Actions'), 'options' => array('class' => 'actions')),
); 

$td = array();
foreach ($pen_test_reports as $i => $pen_test_report)
{
	$edit_id = array(
		'PenTestReport' => $pen_test_report['PenTestReport']['id'],
	);
	$actions = array(
		$this->Html->link(__('View'), array('action' => 'view', $pen_test_report['PenTestReport']['id'], 'admin' => false)),
	);
	if($this->Wrap->roleCheck(array('admin')))
	{
		$actions[] = $this->Html->link(__('Edit'), array('action' => 'edit', $pen_test_report['PenTestReport']['id'], 'admin' => true));
		$actions[] = $this->Html->link(__('Delete'), array('action' => 'delete', $pen_test_report['PenTestReport']['id'], 'admin' => true), array('confirm' => 'Are you sure?'));
	}
	$actions = implode('', $actions);
	
	$report_date_value = false;
	if(strtotime($pen_test_report['PenTestReport']['report_date']))
	{
		$report_date_value = date('Y-m-d 00:00:00', strtotime($pen_test_report['PenTestReport']['report_date']));
	}
	
	$td[$i] = array(
		$this->Html->link($pen_test_report['PenTestReport']['name'], array('action' => 'view', $pen_test_report['PenTestReport']['id'])),
		array('.', array(
			'ajax_count_url' => array('controller' => 'pen_test_results', 'action' => 'pen_test_report', $pen_test_report['PenTestReport']['id']),
			'url' => array('action' => 'view', $pen_test_report['PenTestReport']['id'], 'tab' => 'results'),
		)),
		array(
			$this->Wrap->niceDay($pen_test_report['PenTestReport']['report_date']),
			array('value' => $report_date_value),
		),
		array(
			(isset($pen_test_report['ReportsEvent']['name'])?$this->Html->link($pen_test_report['ReportsEvent']['name'], array('controller' => 'reports_events', 'action' => 'view', $pen_test_report['ReportsEvent']['id'])):''), 
			array('class' => 'nowrap', 'value' => (isset($pen_test_report['ReportsEvent']['id'])?$pen_test_report['ReportsEvent']['id']:'')),
		),
		$this->Wrap->niceTime($pen_test_report['PenTestReport']['created']),
		$this->Wrap->niceTime($pen_test_report['PenTestReport']['modified']),
		array(
			$actions,
			array('class' => 'actions'),
		),
		'edit_id' => $edit_id,
	);
}

$use_gridedit = false;
if($this->Wrap->roleCheck(array('admin')))
	$use_gridedit = true;

echo $this->element('Utilities.page_index', array(
	'page_title' => __('Pen Test Reports'),
	'page_options' => $page_options,
	'th' => $th,
	'td' => $td,
	'use_gridedit' => $use_gridedit,
));